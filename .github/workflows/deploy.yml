name: Deploy to Server

on:
  workflow_dispatch:
  push:
    tags:
      - 'v*'

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master' || startsWith(github.ref, 'refs/tags/v')

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # 可选：部署到自有服务器
      # 需要在 GitHub Secrets 中配置：
      # - SSH_HOST: 服务器 IP
      # - SSH_USER: SSH 用户名
      # - SSH_KEY: SSH 私钥
      # - DEPLOY_PATH: 部署路径（如 /opt/dishu_game）
      
      # - name: Deploy to Server
      #   uses: appleboy/ssh-action@v1.0.0
      #   with:
      #     host: ${{ secrets.SSH_HOST }}
      #     username: ${{ secrets.SSH_USER }}
      #     key: ${{ secrets.SSH_KEY }}
      #     script: |
      #       cd ${{ secrets.DEPLOY_PATH }}
      #       git pull origin main
      #       docker compose pull
      #       docker compose up -d --build
      #       docker system prune -f

      # 或者部署到 Railway/Render 等平台
      # - name: Deploy to Railway
      #   run: |
      #     npm install -g @railway/cli
      #     railway up --service dishu-game
      #   env:
      #     RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
