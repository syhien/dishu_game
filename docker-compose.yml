version: '3.8'

services:
  # Redis æœåŠ¡ï¼ˆç”¨äºä¼šè¯å’Œæˆ¿é—´æ•°æ®ç¼“å­˜ï¼‰
  redis:
    image: redis:7-alpine
    container_name: dishu-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes

  # åç«¯æœåŠ¡
  server:
    build:
      context: ./apps/server
      dockerfile: Dockerfile
    container_name: dishu-server
    ports:
      - "${SERVER_PORT:-3001}:${SERVER_PORT:-3001}"
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - PORT=${SERVER_PORT:-3001}
      - HOST=${SERVER_HOST:-0.0.0.0}
      - REDIS_URL=${REDIS_URL:-redis://redis:6379}
    depends_on:
      - redis
    volumes:
      - ./apps/server:/app
      - /app/node_modules
    restart: unless-stopped

  # å‰ç«¯æœåŠ¡
  web:
    build:
      context: ./apps/web
      dockerfile: Dockerfile
      args:
        # æ„å»ºæ—¶ä¼ å…¥çš„ç¯å¢ƒå˜é‡
        - VITE_APP_NAME=${VITE_APP_NAME:-å˜€å’•æ¸¸æˆ}
        - VITE_APP_SUBTITLE=${VITE_APP_SUBTITLE:-åœ¨çº¿å¤šäººæ¸¸æˆå¹³å°}
        - VITE_APP_LOGO=${VITE_APP_LOGO:-ğŸ®}
        - VITE_THEME_PRIMARY=${VITE_THEME_PRIMARY:-#667eea}
        - VITE_THEME_SECONDARY=${VITE_THEME_SECONDARY:-#764ba2}
    container_name: dishu-web
    ports:
      - "80:80"
    depends_on:
      - server
    restart: unless-stopped

volumes:
  redis_data:
